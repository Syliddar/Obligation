@model List<PlayerCharacterViewModel>

    <h1>Obligation Roll<span id="roll"></span></h1>
    <table id="CharTable" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Charascter Name</th>
                <th>Obligation Total</th>
                <th>Obligation Range</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null)
            {

            @foreach (var pc in Model)
            {
            <tr id="@pc.CharacterName">
                <td>
                    <input type="hidden" id="ObligationStart" value="@pc.ObligationRangeStart" />
                    <input type="hidden" id="ObligationEnd" value="@pc.ObligationRangeEnd" />
                    @pc.CharacterName

                </td>
                <td>@pc.Obligation</td>
                <td>@pc.ObligationRangeStart  - @pc.ObligationRangeEnd</td>
            </tr>
            }
            }
            else
            {
            <tr>
                <td>
                    <h4>UNABLE TO LOAD DATA</h4>
                </td>
                <td>
                    <h4>UNABLE TO LOAD DATA</h4>
                </td>
                <td>
                    <h4>UNABLE TO LOAD DATA</h4>
                </td>
            </tr>
            }
        </tbody>
    </table>
    <h4 id="Message">Feeling Lucky?</h4>
    <button onclick="RollObligation()" class="btn btn-primary">Roll The Fantasy Flight Games Star Wars Edge of the Empire Fantasy Roleplaying System Obligation Check</button>

    <script type="text/javascript">
        function RollObligation() {
            clearStyles()
            var roll = Math.floor(Math.random() * 100) + 1;
            var obligationTriggered = false;
            $('#CharTable > tbody  > tr').each(function () {
                var start = $(this).find("#ObligationStart").val();
                var end = $(this).find("#ObligationEnd").val();
                if (roll >= start && roll <= end) {
                    obligationTriggered = true;
                    if (isCritical(roll)) {
                        var Name = $(this).attr('id');
                        if (name == "MJ-12") {
                            $("#Message").text(Name + " has a CRITICAL Toebligation!");
                        }
                        else {
                            $("#Message").text(Name + " has a CRITICAL Obligation!");
                        }
                        $(this).addClass("table-danger");
                    } else {
                        $("#Message").text($(this).attr('id') + " has Obligation!");
                        $(this).addClass("table-warning");
                    }
                }
            });
            if (obligationTriggered == false) {
                $("#Message").text("Safe!");
            };
            $("#roll").text(": " + roll)
        };
        function clearStyles() {

            $('#CharTable > tbody  > tr').each(function () {
                $(this).removeClass("table-warning");
                $(this).removeClass("table-danger");
            });
        }

        function isCritical(roll) {
            if (roll == 11 || roll == 22 || roll == 33 || roll == 44 || roll == 55 || roll == 66 || roll == 77 || roll == 88 || roll == 99) {
                return true;
            }
            else {
                return false;
            }
        }
    </script>


    @*var totalCurrentObligation = viewModel.Sum(c => c.Obligation);
    viewModel.Add(new PlayerCharacterViewModel
    {
    CharacterName = item.CharacterName,
    Obligation = item.Obligation,
    ObligationRange = (totalCurrentObligation + 1) + " - " + (totalCurrentObligation + item.Obligation)
    });*@
